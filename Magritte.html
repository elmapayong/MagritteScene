<html>
	<head>
		<title>Magritte</title>
		<style>
			body {margin: 0;}
			canvas {width: 100%; height: 100%;}
		</style>
	</head>
	<body>
		<script src="js/Three.js"></script><script src="js/Stats.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/THREEx.KeyboardState.js"></script>
		<script src="js/THREEx.FullScreen.js"></script>
		<script src="js/THREEx.WindowResize.js"></script>

		<div id="ThreeJS" style="z-index: 1; position: absolute; left:0px; top:0px"></div>
		<script>
			var container, scene, camera, renderer, controls, stats;
			var keyboard = new THREEx.KeyboardState();
			var clock = new THREE.Clock();
			var invisiCube;

			init();
			animate();

			function init(){
				scene = new THREE.Scene();
				//CAMERA
				var SCREEN_WIDTH = window.innerWidth;
				var SCREEN_HEIGHT = window.innerHeight;
				var VIEW_ANGLE = 45;
				var ASPECT = SCREEN_WIDTH/SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
				camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
				scene.add(camera);
				camera.position.set(0, 100, 2400);

				var invisiCubeGeometry = new THREE.CubeGeometry(1,1,1,1,1,1);
				var invisiCubeMaterials = new THREE.MeshBasicMaterial({color: 0xff3333});
				//var invisiCubeMaterials = new THREE.Material();
				//invisiCubeMaterials.opacity(0.5);
				invisiCube = new THREE.Mesh(invisiCubeGeometry, invisiCubeMaterials);
				invisiCube.position.set(0, 50, 2000);
				scene.add(invisiCube);

				camera.lookAt(scene.position);

				//RENDERER
				if(Detector.webgl)
					renderer = new THREE.WebGLRenderer({antialias:true});
				else
					renderer = new THREE.CanvasRenderer();
				renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
				container = document.getElementById('ThreeJS');
				container.appendChild(renderer.domElement);

				//EVENTS
				THREEx.WindowResize(renderer,camera);	//auto resize
				THREEx.FullScreen.bindKey({charCode : 'm'.charCodeAt(0)});

				//MOUSE CONTROLS - left:rotate, mid:zoom, right:pan
				//controls = new THREE.OrbitControls(camera, renderer.domElement);

				//LIGHT
				var light = new THREE.PointLight(0xffffff);
				light.position.set(0, 250, 0);
				scene.add(light);
				var ambientLight = new THREE.AmbientLight(0x111111);
				scene.add(ambientLight);

				//SKYBOX
				var skyTexture = new THREE.ImageUtils.loadTexture('images/sky_hd.jpg');
				skyTexture.wrapS = skyTexture.wrapT = THREE.RepeatWrapping;
				skyTexture.repeat.set(10, 10);
				var skyMaterial = new THREE.MeshBasicMaterial({map: skyTexture, side: THREE.BackSide});

				// var skyMaterial = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('images/blue_sky.jpg'), side: THREE.BackSide});

				//var skyGeometry = new THREE.CubeGeometry(5000, 5000, 5000);
				var skyGeometry = new THREE.SphereGeometry(5000, 100, 100);
				var sky = new THREE.Mesh(skyGeometry, skyMaterial);
				scene.add(sky);

				//OBJECTS
				//sphere mesh:
				//(radius ,width segments, height segments)
				var sphereGeometry = new THREE.SphereGeometry(50, 32, 16);
				var sphereMaterial = new THREE.MeshLambertMaterial({color: 0x8888ff});
				var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
				sphere.position.set(100, 50, -50);
				scene.add(sphere);

				//cube mesh:
				//array of materials, one for each side
				//x+, x-, y+, y-, z+, z-
				var cubeMaterialArray = [];
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0xff3333}));
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0xff8800}));
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0xffff33}));
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0x33ff33}));
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0x3333ff}));
				cubeMaterialArray.push(new THREE.MeshLambertMaterial({color: 0x8833ff}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0xff3333}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0xff8800}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0xffff33}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0x33ff33}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0x3333ff}));
				// cubeMaterialArray.push(new THREE.MeshBasicMaterial({color: 0x8833ff}));
				var cubeMaterials = new THREE.MeshFaceMaterial(cubeMaterialArray);
				//(width, height, depth, segmentsW, segmentsH, segementsD)
				var cubeGeometry = new THREE.CubeGeometry(100, 100, 100, 1, 1, 1);
				var cube = new THREE.Mesh(cubeGeometry, cubeMaterials);
				cube.position.set(-100, 50, -50);
				scene.add(cube);

				//coordinate axis to help orient user
				var axes = new THREE.AxisHelper(100);//(length in pixels in each direction)
				scene.add(axes);

				//ground plane:
				var floorTexture = new THREE.ImageUtils.loadTexture('images/grass.jpg');
				floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
				floorTexture.repeat.set(100, 100);
				//render on both sides of mesh
				var floorMaterial = new THREE.MeshBasicMaterial({map: floorTexture, side: THREE.BackSide});
				var floorGeometry = new THREE.PlaneGeometry(10000, 10000, 1, 1);
				var floor = new THREE.Mesh(floorGeometry, floorMaterial);
				floor.position.y = -0.5;
				floor.rotation.x = Math.PI/2;
				scene.add(floor);

				//SKY
				var skyBoxGeometry = new THREE.CubeGeometry(10000, 10000, 10000);
				//render faces from inside the cube instead of outside
				var skyBoxMaterial = new THREE.MeshBasicMaterial({color: 0x9999ff, side: THREE.BackSide});
				var skyBox = new THREE.Mesh(skyBoxGeometry, skyBoxMaterial);
				//scene.add(skyBox)

				//OR FOG - must be added to scene before first render
				scene.fog = new THREE.FogExp2(0x9999ff, 0.00025);

			}

			function animate(){
				requestAnimationFrame(animate);
				render();
				update();
			}

			function update(){
				//change in time since last call (in seconds)
				var delta = clock.getDelta();
				var moveDistance = 500 * delta;	//200px/second
				var rotateAngle = Math.PI/2 * delta;	//pi/2 radians (90 degrees/sec)

				//moving forward, backward, left, right
				if(keyboard.pressed("W"))
					invisiCube.translateZ(-moveDistance);
				if(keyboard.pressed("S"))
					invisiCube.translateZ(moveDistance);
				if(keyboard.pressed("Q"))
					invisiCube.translateX(-moveDistance);
				if(keyboard.pressed("E"))
					invisiCube.translateX(moveDistance);

				//rotate left, right, up, down
				//var rotation_matrix = new THREE.Matrix4().identity();
				if(keyboard.pressed("A"))
					invisiCube.rotateOnAxis(new THREE.Vector3(0, 1, 0), rotateAngle);
				if(keyboard.pressed("D"))
					invisiCube.rotateOnAxis(new THREE.Vector3(0, 1, 0), -rotateAngle);
				if(keyboard.pressed("R"))
					invisiCube.rotateOnAxis(new THREE.Vector3(1, 0, 0), rotateAngle);
				if(keyboard.pressed("F"))
					invisiCube.rotateOnAxis(new THREE.Vector3(1, 0, 0), -rotateAngle);

				var relativeCameraOffset = new THREE.Vector3(0, 1, 200);

				var cameraOffset = relativeCameraOffset.applyMatrix4(invisiCube.matrixWorld);

				camera.position.x = cameraOffset.x;
				camera.position.y = cameraOffset.y;
				camera.position.z = cameraOffset.z;
				camera.lookAt(invisiCube.position);

				// if(keyboard.pressed("1"))
				// 	document.getElementById('message').innerHTML = 'Have a nice day! - 1';
				// if(keyboard.pressed("2"))
				// 	document.getElementById('message').innerHTML = 'Have a nice day! - 2';

				//controls.update();
				

			}

			function render(){
				renderer.render(scene, camera);
			}



		</script>
	</body>
</html>

